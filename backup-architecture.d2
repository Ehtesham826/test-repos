# Backup Architecture Diagram
# SCP Infrastructure

title: {
  label: SCP Backup Architecture
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
  }
}

# Kubernetes Cluster
cluster: {
  label: Kubernetes Cluster
  style: {
    fill: "#e8f4f8"
    stroke: "#2980b9"
  }

  sol: {
    label: SOL (Master #1)
    shape: rectangle
    style: {
      fill: "#3498db"
      font-color: white
    }
  }

  terra: {
    label: TERRA (Master #2)
    shape: rectangle
    style: {
      fill: "#3498db"
      font-color: white
    }
  }

  luna: {
    label: LUNA (GPU Worker)
    shape: rectangle
    style: {
      fill: "#9b59b6"
      font-color: white
    }
  }

  pluto: {
    label: PLUTO (GPU Worker)
    shape: rectangle
    style: {
      fill: "#9b59b6"
      font-color: white
    }
  }

  velero: {
    label: Velero
    shape: hexagon
    style: {
      fill: "#27ae60"
      font-color: white
    }
  }

  longhorn: {
    label: Longhorn
    shape: hexagon
    style: {
      fill: "#e67e22"
      font-color: white
    }
  }

  etcd: {
    label: etcd
    shape: cylinder
    style: {
      fill: "#34495e"
      font-color: white
    }
  }

  databases: {
    label: Databases
    shape: cylinder
    style: {
      fill: "#8e44ad"
      font-color: white
    }
  }
}

# NAS Storage
nas: {
  label: NAS Storage (10.10.30.50)
  style: {
    fill: "#fff3cd"
    stroke: "#856404"
  }

  velero_backups: {
    label: /velero-backups
    shape: cylinder
    style: {
      fill: "#ffc107"
    }
  }

  longhorn_backups: {
    label: /longhorn-backups
    shape: cylinder
    style: {
      fill: "#ffc107"
    }
  }

  etcd_backups: {
    label: /etcd-backups
    shape: cylinder
    style: {
      fill: "#ffc107"
    }
  }

  db_backups: {
    label: /database-backups
    shape: cylinder
    style: {
      fill: "#ffc107"
    }
  }
}

# Retention Policy Box
retention: {
  label: Retention Policies
  style: {
    fill: "#f8f9fa"
    stroke: "#6c757d"
  }

  velero_ret: {
    label: Velero: 30 days
    shape: rectangle
    style: {
      fill: white
    }
  }

  longhorn_ret: {
    label: Longhorn: 7 days
    shape: rectangle
    style: {
      fill: white
    }
  }

  etcd_ret: {
    label: etcd: 7 days
    shape: rectangle
    style: {
      fill: white
    }
  }

  db_ret: {
    label: Database: 30 days
    shape: rectangle
    style: {
      fill: white
    }
  }
}

# Backup Flows
cluster.velero -> nas.velero_backups: Daily 2AM {
  style: {
    stroke: "#27ae60"
    stroke-width: 2
  }
}

cluster.longhorn -> nas.longhorn_backups: Every 6 hours {
  style: {
    stroke: "#e67e22"
    stroke-width: 2
  }
}

cluster.etcd -> nas.etcd_backups: Every 12 hours {
  style: {
    stroke: "#34495e"
    stroke-width: 2
  }
}

cluster.databases -> nas.db_backups: Daily 1AM {
  style: {
    stroke: "#8e44ad"
    stroke-width: 2
  }
}

# Layout connections
nas.velero_backups -> retention.velero_ret: {style.opacity: 0}
nas.longhorn_backups -> retention.longhorn_ret: {style.opacity: 0}
nas.etcd_backups -> retention.etcd_ret: {style.opacity: 0}
nas.db_backups -> retention.db_ret: {style.opacity: 0}
